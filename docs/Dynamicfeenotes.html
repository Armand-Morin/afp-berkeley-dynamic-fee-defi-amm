<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ul.lst-kix_xusvxbe2up-8{list-style-type:none}ul.lst-kix_xusvxbe2up-7{list-style-type:none}ul.lst-kix_xusvxbe2up-0{list-style-type:none}ul.lst-kix_xusvxbe2up-2{list-style-type:none}ul.lst-kix_xusvxbe2up-1{list-style-type:none}ul.lst-kix_xusvxbe2up-4{list-style-type:none}ul.lst-kix_xusvxbe2up-3{list-style-type:none}ul.lst-kix_xusvxbe2up-6{list-style-type:none}ul.lst-kix_xusvxbe2up-5{list-style-type:none}.lst-kix_adx8mc7xs5ve-4>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-3>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-8>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-2>li:before{content:"-  "}.lst-kix_k80rlir6zwz6-6>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-0>li:before{content:"-  "}ul.lst-kix_ki62lf6vxzn3-1{list-style-type:none}ul.lst-kix_ki62lf6vxzn3-0{list-style-type:none}.lst-kix_adx8mc7xs5ve-1>li:before{content:"-  "}.lst-kix_k80rlir6zwz6-5>li:before{content:"-  "}ul.lst-kix_ki62lf6vxzn3-5{list-style-type:none}ul.lst-kix_ki62lf6vxzn3-4{list-style-type:none}ul.lst-kix_ki62lf6vxzn3-3{list-style-type:none}ul.lst-kix_ki62lf6vxzn3-2{list-style-type:none}.lst-kix_k80rlir6zwz6-4>li:before{content:"-  "}ul.lst-kix_adx8mc7xs5ve-2{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-3{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-4{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-5{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-0{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-1{list-style-type:none}.lst-kix_k80rlir6zwz6-7>li:before{content:"-  "}.lst-kix_k80rlir6zwz6-8>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-5>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-6>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-8>li:before{content:"-  "}.lst-kix_adx8mc7xs5ve-7>li:before{content:"-  "}ul.lst-kix_adx8mc7xs5ve-6{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-7{list-style-type:none}ul.lst-kix_adx8mc7xs5ve-8{list-style-type:none}.lst-kix_2yo0e3li4rny-1>li:before{content:"-  "}.lst-kix_2yo0e3li4rny-0>li:before{content:"-  "}.lst-kix_2yo0e3li4rny-4>li:before{content:"-  "}.lst-kix_2yo0e3li4rny-5>li:before{content:"-  "}ul.lst-kix_k80rlir6zwz6-8{list-style-type:none}ul.lst-kix_j4emzdhuck1n-2{list-style-type:none}ul.lst-kix_j4emzdhuck1n-1{list-style-type:none}ul.lst-kix_j4emzdhuck1n-0{list-style-type:none}.lst-kix_2yo0e3li4rny-6>li:before{content:"-  "}ul.lst-kix_wvg6jug8slkn-7{list-style-type:none}ul.lst-kix_j4emzdhuck1n-6{list-style-type:none}ul.lst-kix_k80rlir6zwz6-3{list-style-type:none}ul.lst-kix_wvg6jug8slkn-8{list-style-type:none}ul.lst-kix_j4emzdhuck1n-5{list-style-type:none}ul.lst-kix_k80rlir6zwz6-2{list-style-type:none}ul.lst-kix_j4emzdhuck1n-4{list-style-type:none}ul.lst-kix_k80rlir6zwz6-1{list-style-type:none}ul.lst-kix_j4emzdhuck1n-3{list-style-type:none}ul.lst-kix_k80rlir6zwz6-0{list-style-type:none}ul.lst-kix_wvg6jug8slkn-3{list-style-type:none}ul.lst-kix_k80rlir6zwz6-7{list-style-type:none}ul.lst-kix_wvg6jug8slkn-4{list-style-type:none}ul.lst-kix_k80rlir6zwz6-6{list-style-type:none}ul.lst-kix_wvg6jug8slkn-5{list-style-type:none}ul.lst-kix_j4emzdhuck1n-8{list-style-type:none}ul.lst-kix_k80rlir6zwz6-5{list-style-type:none}ul.lst-kix_wvg6jug8slkn-6{list-style-type:none}ul.lst-kix_j4emzdhuck1n-7{list-style-type:none}ul.lst-kix_k80rlir6zwz6-4{list-style-type:none}ul.lst-kix_wvg6jug8slkn-0{list-style-type:none}ul.lst-kix_wvg6jug8slkn-1{list-style-type:none}.lst-kix_2yo0e3li4rny-3>li:before{content:"-  "}ul.lst-kix_wvg6jug8slkn-2{list-style-type:none}.lst-kix_2yo0e3li4rny-2>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-1>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-1>li:before{content:"-  "}ul.lst-kix_ki62lf6vxzn3-8{list-style-type:none}.lst-kix_ki62lf6vxzn3-0>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-2>li:before{content:"-  "}ul.lst-kix_ki62lf6vxzn3-7{list-style-type:none}ul.lst-kix_ki62lf6vxzn3-6{list-style-type:none}.lst-kix_j4emzdhuck1n-0>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-5>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-6>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-7>li:before{content:"-  "}.lst-kix_2yo0e3li4rny-7>li:before{content:"-  "}.lst-kix_2yo0e3li4rny-8>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-4>li:before{content:"-  "}.lst-kix_ki62lf6vxzn3-3>li:before{content:"-  "}.lst-kix_c3zy5jng8wud-4>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-8>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-8{list-style-type:none}ul.lst-kix_gvfsbmlm25iq-6{list-style-type:none}.lst-kix_gvfsbmlm25iq-7>li:before{content:"-  "}.lst-kix_c3zy5jng8wud-3>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-7{list-style-type:none}.lst-kix_c3zy5jng8wud-5>li:before{content:"-  "}.lst-kix_c3zy5jng8wud-2>li:before{content:"-  "}.lst-kix_c3zy5jng8wud-6>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-0{list-style-type:none}.lst-kix_c3zy5jng8wud-0>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-1{list-style-type:none}.lst-kix_gvfsbmlm25iq-5>li:before{content:"-  "}.lst-kix_c3zy5jng8wud-1>li:before{content:"-  "}ul.lst-kix_c3zy5jng8wud-1{list-style-type:none}.lst-kix_xusvxbe2up-0>li:before{content:"-  "}.lst-kix_xusvxbe2up-2>li:before{content:"-  "}ul.lst-kix_c3zy5jng8wud-0{list-style-type:none}.lst-kix_c3zy5jng8wud-7>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-4{list-style-type:none}.lst-kix_gvfsbmlm25iq-6>li:before{content:"-  "}ul.lst-kix_c3zy5jng8wud-3{list-style-type:none}ul.lst-kix_gvfsbmlm25iq-5{list-style-type:none}ul.lst-kix_c3zy5jng8wud-2{list-style-type:none}ul.lst-kix_gvfsbmlm25iq-2{list-style-type:none}ul.lst-kix_c3zy5jng8wud-5{list-style-type:none}.lst-kix_xusvxbe2up-1>li:before{content:"-  "}ul.lst-kix_gvfsbmlm25iq-3{list-style-type:none}ul.lst-kix_c3zy5jng8wud-4{list-style-type:none}.lst-kix_c3zy5jng8wud-8>li:before{content:"-  "}ul.lst-kix_c3zy5jng8wud-7{list-style-type:none}ul.lst-kix_c3zy5jng8wud-6{list-style-type:none}.lst-kix_xusvxbe2up-4>li:before{content:"-  "}.lst-kix_xusvxbe2up-6>li:before{content:"-  "}ul.lst-kix_c3zy5jng8wud-8{list-style-type:none}.lst-kix_xusvxbe2up-3>li:before{content:"-  "}.lst-kix_xusvxbe2up-7>li:before{content:"-  "}.lst-kix_xusvxbe2up-5>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-2>li:before{content:"-  "}ul.lst-kix_2yo0e3li4rny-8{list-style-type:none}ul.lst-kix_2yo0e3li4rny-7{list-style-type:none}.lst-kix_j4emzdhuck1n-3>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-4>li:before{content:"-  "}ul.lst-kix_2yo0e3li4rny-6{list-style-type:none}ul.lst-kix_2yo0e3li4rny-5{list-style-type:none}.lst-kix_j4emzdhuck1n-5>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-6>li:before{content:"-  "}.lst-kix_xusvxbe2up-8>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-8>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-0>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-1>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-5>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-7>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-7>li:before{content:"-  "}.lst-kix_j4emzdhuck1n-8>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-6>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-4>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-3>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-3>li:before{content:"-  "}.lst-kix_gvfsbmlm25iq-2>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-4>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-2>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-1>li:before{content:"-  "}.lst-kix_wvg6jug8slkn-0>li:before{content:"-  "}ul.lst-kix_2yo0e3li4rny-4{list-style-type:none}ul.lst-kix_2yo0e3li4rny-3{list-style-type:none}ul.lst-kix_2yo0e3li4rny-2{list-style-type:none}ul.lst-kix_2yo0e3li4rny-1{list-style-type:none}ul.lst-kix_2yo0e3li4rny-0{list-style-type:none}.lst-kix_k80rlir6zwz6-1>li:before{content:"-  "}.lst-kix_k80rlir6zwz6-3>li:before{content:"-  "}.lst-kix_k80rlir6zwz6-2>li:before{content:"-  "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_k80rlir6zwz6-0>li:before{content:"-  "}ol{margin:0;padding:0}table td,table th{padding:0}.c19{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:113.2pt;border-top-color:#000000;border-bottom-style:solid}.c22{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:69.8pt;border-top-color:#000000;border-bottom-style:solid}.c7{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:174.8pt;border-top-color:#000000;border-bottom-style:solid}.c17{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:112.5pt;border-top-color:#000000;border-bottom-style:solid}.c18{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:64.5pt;border-top-color:#000000;border-bottom-style:solid}.c12{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:51pt;border-top-color:#000000;border-bottom-style:solid}.c24{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:58.5pt;border-top-color:#000000;border-bottom-style:solid}.c2{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:108.8pt;border-top-color:#000000;border-bottom-style:solid}.c21{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:53.2pt;border-top-color:#000000;border-bottom-style:solid}.c13{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:61.5pt;border-top-color:#000000;border-bottom-style:solid}.c14{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:57.8pt;border-top-color:#000000;border-bottom-style:solid}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:justify;height:11pt}.c29{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c27{color:#000000;text-decoration:none;vertical-align:baseline;font-size:13pt;font-family:"Arial";font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c20{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:justify}.c9{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left;height:11pt}.c10{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c28{margin-left:auto;border-spacing:0;border-collapse:collapse;margin-right:auto}.c23{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c11{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;text-decoration:underline}.c30{orphans:2;widows:2}.c8{margin-left:36pt;padding-left:0pt}.c26{color:inherit;text-decoration:inherit}.c3{padding:0;margin:0}.c25{color:#1155cc}.c0{height:0pt}.c16{height:11pt}.c15{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c23 doc-content"><p class="c29"><span class="c15 c27">Notes multi model fee</span></p><p class="c5 c16"><span class="c1"></span></p><p class="c6"><span class="c1">Why don&#39;t we really care about using a z score finally. We will calibrate a model per pool so per price difference and in this case we don&#39;t really need to have standardized features as input for the model. Of course we prefer to have them stationary but I guess this mode will also be recalibrated on a weekly or monthly basis so if the data is stationary on that period then it is not necessary.</span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c6"><span class="c1">The sigmoid function is removed for more clarity in the model </span></p><p class="c6"><span class="c1">The purple plot shows the combine fee that we quote for a swap using the model. We can see that even if we apply a fee using the linear model the final combined fee can be different. This is because we will combine it with the other fees computed using the other factors. For instance on the arb_pnl factor fee we can see that our model is quoting a free of 0.05 % when no profits are made but the purple plot on the left of the graph is positive and showing a higher fee. This is because for instance most of the time when the volatility is high, there can be negative theoretical profit for the trader and in this case the fee from the std graph will be used and that&#39;s why the purple combined fee is not 0</span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><a id="t.4f0daadf0c020fd23d737a8f8c486dfbc8dc1710"></a><a id="t.0"></a><table class="c28"><tr class="c0"><td class="c21" colspan="1" rowspan="1"><p class="c10"><span class="c1">Tx id</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c5"><span class="c1">Amount1 (buy swaps)</span></p></td><td class="c24" colspan="1" rowspan="1"><p class="c5"><span class="c1">Arb pnl (in %)</span></p></td><td class="c18" colspan="1" rowspan="1"><p class="c5"><span class="c1">Volatility</span></p></td><td class="c22" colspan="1" rowspan="1"><p class="c5"><span class="c1">Amount1 fee</span></p></td><td class="c12" colspan="1" rowspan="1"><p class="c5"><span class="c1">Arb pnl fee</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">Volatility fee</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">Amount1 weighted fee</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">Arb pnl weighted fee</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">Volatility weighted fee</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">Combined fee </span></p></td></tr><tr class="c0"><td class="c21" colspan="1" rowspan="1"><p class="c10"><span class="c1">0</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c10"><span class="c1">-100</span></p></td><td class="c24" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.02</span></p></td><td class="c18" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.10</span></p></td><td class="c22" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c12" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.10</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.010</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.005 </span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.030</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.002</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.00032</span></p></td></tr><tr class="c0"><td class="c21" colspan="1" rowspan="1"><p class="c10"><span class="c1">1</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c10"><span class="c1">-50</span></p></td><td class="c24" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c18" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.20</span></p></td><td class="c22" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c12" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.055</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.005</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.003 </span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.011 &nbsp;</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.00014</span></p></td></tr><tr class="c0"><td class="c21" colspan="1" rowspan="1"><p class="c10"><span class="c1">2</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c10"><span class="c1">-30</span></p></td><td class="c24" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c18" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.15 </span></p></td><td class="c22" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.0357</span></p></td><td class="c12" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.01</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.010</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.0178</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.003 </span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.002</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c5"><span class="c1">0.00005</span></p></td></tr></table><p class="c5 c16"><span class="c1"></span></p><p class="c5"><span>{&#39;arb_pnl&#39;: 0.3, &#39;std&#39;: 0.2, &#39;amount1&#39;: 0.5}</span></p><p class="c5 c16"><span class="c1"></span></p><a id="t.77b9a20bb6d7697f2925ca7c032c1811694d8c53"></a><a id="t.1"></a><table class="c28"><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">Constant fee model</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c10"><span class="c1">5 &nbsp;Factors Model</span></p><p class="c10 c30"><span class="c1">(TradeFi Factors)</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">7 &nbsp;Factors Model (DeFi Factors)</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">2 &nbsp;Factors Model (Arb P&amp;L, Volatility)</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">2 &nbsp;Factors Model (price diff, amountUSD)</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">10 &nbsp;Factors Model </span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">Single Model</span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Percent of additional profits of the dynamic fee over the constant fee model</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp;0.0 %</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp;0.0 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp;0.0 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.01 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.01 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Price impact percent improvement (decreased impact) of the dynamic fee model </span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp;0.0 %</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">0.0 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp;0.0 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.01 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.01 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05 %</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.1744</span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Average dynamic selling fee (%)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.05</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">-0.07</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.07</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.08</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.07</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.1816</span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Average dynamic buying fee (%)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.04</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Impermanent loss in %</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">-1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c4"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Average t cost in $</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">93.06</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">47.31</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">90.89</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">100.51</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">38.77</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Average on 1 min selling_fee</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.05</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">-0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.03</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.04</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.04</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Average on 1 min buying_fee</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">0.02</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.02</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.02</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.02</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.02</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Weighted average buying_fee ($)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05 </span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">0.06</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.05</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.07</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">0.06</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">18.967</span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Weighted average selling_fee</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.05</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">-0.08</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.06</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.08</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.09</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">-0.08</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">19.052</span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Accuracy of the fees (in the range of the constant fee trader will be willing to pay)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">100%</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">7.53%</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">9.86%</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">7.81%</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">7.4%</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c10"><span class="c1">4.2%</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Feature importance</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">NA</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span class="c1">std: 0.17,</span></p><p class="c6"><span class="c1">price_impact: 0.15,</span></p><p class="c6"><span class="c1">lambda_1min: 0.12,</span></p><p class="c6"><span class="c1">&nbsp;lambda_5min: 0.14,</span></p><p class="c6"><span class="c1">&nbsp;amountUSD: 0.4</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">price_diff&#39;: 0.25,</span></p><p class="c6"><span class="c1">arb_pnl&#39;: 0.25,</span></p><p class="c6"><span class="c1">std&#39;: 0.07,</span></p><p class="c6"><span class="c1">price_impact&#39;: 0.07,</span></p><p class="c6"><span class="c1">lambda 1min: 0.05,</span></p><p class="c6"><span class="c1">Lambda 5min: 0.05,</span></p><p class="c6"><span class="c1">amountUSD&#39;: 0.27</span></p><p class="c4"><span class="c1"></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">arb_pnl 0.54, </span></p><p class="c6"><span class="c1">std 0.47</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">Price diff 0.4, amount USD 0.6</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c1">LVR nb token 0.12,</span></p><p class="c6"><span class="c1">Price diff 0.25,</span></p><p class="c6"><span class="c1">Arb pnl 0.15,</span></p><p class="c6"><span class="c1">std 0.07,</span></p><p class="c6"><span class="c1">Price impact 0.06,</span></p><p class="c6"><span class="c1">Lambda 1min 0.04,</span></p><p class="c6"><span class="c1">Lambda 5min 0.05,</span></p><p class="c6"><span class="c1">amountUSD&#39;: 0.27</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c4"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Factor Model Penalized</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c10"><span class="c1">Appendix 0</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c4"><span class="c1"></span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1478.00px; height: 1049.00px;"><img alt="" src="images/image11.png" style="width: 1478.00px; height: 1049.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">Appendix 1</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1478.00px; height: 1524.00px;"><img alt="" src="images/image8.png" style="width: 1478.00px; height: 1524.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c1">Appendix 2</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 993.00px; height: 574.00px;"><img alt="" src="images/image4.png" style="width: 993.00px; height: 574.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">Appendix 3</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 993.00px; height: 574.00px;"><img alt="" src="images/image2.png" style="width: 993.00px; height: 574.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">Appendix 4</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1478.00px; height: 1524.00px;"><img alt="" src="images/image10.png" style="width: 1478.00px; height: 1524.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5 c16"><span class="c1"></span></p></td></tr><tr class="c0"><td class="c7" colspan="1" rowspan="1"><p class="c6"><span class="c1">Volume as a function of fees and arb profits in %</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c9"><span class="c1"></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1485.00px; height: 955.00px;"><img alt="" src="images/image5.png" style="width: 1485.00px; height: 955.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 822.00px; height: 545.00px;"><img alt="" src="images/image9.png" style="width: 822.00px; height: 545.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1488.00px; height: 1430.00px;"><img alt="" src="images/image1.png" style="width: 1488.00px; height: 1430.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1490.00px; height: 480.00px;"><img alt="" src="images/image6.png" style="width: 1490.00px; height: 480.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1490.00px; height: 480.00px;"><img alt="" src="images/image3.png" style="width: 1490.00px; height: 480.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5 c16"><span class="c1"></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c5 c16"><span class="c1"></span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5"><span class="c20 c15">Process Overview</span></p><p class="c6"><span class="c1">The global fee for a swap transaction is determined through a multi-step process that integrates transaction-specific data, feature-based adjustments, and weighted contributions from various transaction characteristics. This methodology aims to compute a fee that reflects both the market dynamics captured by the dataset and the intrinsic value or risk associated with each transaction.</span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5"><span class="c20 c15">Steps to Calculate the Global Fee</span></p><ul class="c3 lst-kix_ki62lf6vxzn3-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Data Segmentation</span><span class="c1">: The dataset is initially segmented into two subsets based on the direction of the transaction&mdash;purchases (buy) and sales (sell). This distinction allows for differentiated fee calculations that account for the inherent differences in buying versus selling transactions.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_wvg6jug8slkn-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Feature-Based Quantile Scalin</span><span class="c1">g: For each relevant feature in the dataset (e.g., price difference, transaction volume), quantile-based scaling boundaries are established. These boundaries, determined by specified lower and upper quantiles, serve to winsorize the feature values and mitigate the impact of outliers on the model calibration.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_adx8mc7xs5ve-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Fee Quantile Thresholds</span><span class="c1">: Within each transaction subset (buy and sell), fee quantile thresholds are calculated for the given feature. These thresholds help in identifying the range within which the majority of transactions occur, allowing for a more focused and representative fee adjustment. The idea is to apply the linear fee to the majority of the fees and to put in max or min for the tail values.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_c3zy5jng8wud-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Weight Calculation</span><span class="c1">: Weights for the fee calculation are derived based on the quantile thresholds. These weights represent the slope of the model to adjust the fee on the feature&#39;s value, ensuring that the fee scales appropriately with the feature&#39;s impact on the swap factors.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_2yo0e3li4rny-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Fee Application</span><span class="c1">: Adjusted fees are applied to each transaction within the buy and sell subsets. This step involves calculating a fee for each transaction based on its feature values, using the previously determined weights and scaling factors.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_gvfsbmlm25iq-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Data Reintegration and Weighted Fee Summation</span><span class="c1">: The adjusted buy and sell subsets are recombined into a single dataset. A global fee for each transaction is then computed by summing the weighted fees across all considered features. This summation integrates the influence of multiple transaction characteristics into a single fee metric.</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c3 lst-kix_j4emzdhuck1n-0 start"><li class="c6 c8 li-bullet-0"><span class="c11">Normalization and Final Adjustments</span><span class="c1">: The combined fee is normalized (e.g., divided by 100 if necessary) to ensure it falls within a reasonable and interpretable range. Additional adjustments, such as separating fees into buying and selling components based on transaction direction or calculating target fees in USD, further refine the fee to reflect specific transaction contexts.</span></li></ul><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c5 c16"><span class="c1"></span></p><p class="c6"><span class="c1">The average gas price was computed using the average gas price per block. Before I was about to take the rolling historical average gas price of the transaction but most of the transactions are coming from arbitrageurs so they all pay high gas prices which won&#39;t be a good indication of the average gas price on the blockchain at that block. &nbsp;That&#39;s why I had to query separately all the transactions of the block to compute the average gas paid in the block. </span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">I take the fee as a target of my model to understand the structure of the factors, features of the model. The idea is to compute a hypothetical global fee traders pay by taking into account full transaction cost (gas fee + pool fee). We subtract the normal gas price they should pay from the instantaneous arbitrage profit they have and then divide by the amount they trade to get an idea of the percentage fee we can charge.</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">We add some factors to the model to take into account for multiple parameters when quoting the fee to the transaction.</span></p><p class="c6"><span class="c1">Additional factors to take as input : The liquidity added by a given user in the pool he is trading with. The more liquidity a user is adding to the pool, the better the fee will be.</span></p><p class="c6"><span class="c1">All of them are here but we won&#39;t use them all:</span></p><p class="c6"><span class="c1">&#39;LVR_nbtoken&#39;, &#39;price_diff&#39;, &#39;arb_pnl&#39;, &#39;std&#39;, &#39;mean_rol_amount&#39;, &#39;avg_gas&#39;, &#39;price_impact&#39;, &#39;rol_amountUSD&#39;, &#39;lambda_1min&#39;, &#39;rol_1min_span&#39;, &#39;rol_1m_trade_count&#39;, &#39;lambda_5min&#39;, &#39;rol_5min_span&#39;, &#39;rol_5m_trade_count&#39;, &#39;amountUSD&#39;</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Arb_pnl&#39;</span><span class="c1">&nbsp;is the theoretical arbitrage an arbitrager can make with the basic DEX - CEX arbitrage</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Lambda_1min&#39; and &#39;lambda_5min&#39;</span><span class="c1">&nbsp;are the coefficients of the poisson process using a 1 and 5 minute rolling period to count the arrival transaction number. It helps us to know when the market is busy and people are rushing to make their arbitrage. We can charge a higher fee for different levels of the lambda and then take into account the trend follower arbitrageurs.</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Price_impact&#39;</span><span class="c1">&nbsp;is the price impact computed of the swap on the pool. It doesn&#39;t constitute looking ahead because in a DEX we can compute it ahead with the liquidity and the amount. The formulas are: (cf the paper of previous years) So the price impact is inversely proportional to the liquidity in the pool. We want to charge a higher fee when the liquidity is low in the pool (i.e. trades have a large price impact) then this incentivizes LP to put in more money because they receive a higher fee after each swap and then the liquidity comes back.</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;rol_amountUSD&#39;</span><span class="c1">&nbsp;is a proxy for the volume on the rolling period</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Avg_gas&#39;</span><span class="c1">&nbsp;is the average gas paid by transactions in the last 30 blocks &nbsp;. This won&#39;t be a factor accessible at the time the trader wants to swap because we only know the gas fee they paid after the transaction got executed on the blockchain. </span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Std&#39;</span><span class="c1">&nbsp;volatility in the pool</span></p><p class="c6"><span class="c15">&#39;LVR_nbtoken&#39; </span><span class="c1">number of token that the LVR profits represent</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">One consideration to take is that the arbitrage might be smaller that the actual transaction price they pay which doesn&#39;t make sense for an arbitrager. The reason is because when using uniswap, you can specify a bundle of all the swap you want to perform into one multicall transaction so you would pay for only one tx instead of multiple. The arbitrageurs perform usually a multi pool arbitrage and because it is a mathematical equation you can compute the amount you need to do so. This means that arbitrageurs are also looking for additional profits on other pools</span></p><p class="c6"><span class="c1">First the arbitrage profit (price difference) theory is very linked with the gas paid for transactions on the exchange which is good because it means we identify one reason for the arbitrage.</span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">After computing all those factors, the idea is to penalize each of them with a simple linear model. This will give a fee for each factor that we want to look at. Now we need to combine and aggregate back the multiple fees per factor to get a single selling and buying fee for the transaction. The idea is to use a normalized feature importance summing to one to weight the different factore. To do that we use a random forest (or any other tree models can work) to get the importance of the factors. We calibrate this tree model to predict the target global fee percent of the trader. It gives us the structure in the fee to apply. THe target fee is the fee that should have been applied to make the exchange profitable for liquidity providers. The idea is to be able to reduce the profit of the arbitrager to the minimal value (still allowing them to make an arbitrage profit otherwise no arbitrageurs would come and update the price). Arbitrageurs are not bad for the exchange, it becomes toxic when it represents the majority of the volume and when they are making too big profits. At this time it won&#39;t become profitable for market makers and liquidity providers. Given that we want to secure a profit for them but as small as possible and also allow for some error and uncertainty in the way we co:pute the margin they have. Then we subtract an average fee they should have paid for this transaction and this fee is generally smaller than the transaction gas price they pay for their arbitrage. The remaining part should be the fee to charge for the liquidity providers not to suffer from a loss anytime someone wants to arbitrage the price difference. </span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">In general the way to build an exchange this way allow for normal traders to </span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">So how do we calibrate a model for each factor &#128077;</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">We compute the quantile of the feature and scale the sigmoid such that the bigger quantile has the smallest fee (f_min) and the smaller quantile has the highest fee (f_max). This gives a line for the theoretical model looking like a collard option payoff from f_min to f_max and. Then we try to calibrate a sigmoid function to make it smoother. Finally we weight each individual features on the importance of the tree model and get the combined total weight to apply for this particular swap.. Some fitness parameters also needed to be taken into account.</span></p><p class="c6"><span class="c1">In final all we need is the size of the decile we want to calibrate a given factor and then the sigmoid adapts the steepness, centroid of the curve of the model.</span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">Some additional considerations.</span></p><ul class="c3 lst-kix_k80rlir6zwz6-0 start"><li class="c6 c8 li-bullet-0"><span class="c1">Why did we forget about the simulation: because it is too complex to model jointly the arbitrager behavior with the price difference (price DEX and price CEX). To get a realistic simulator, we need to be able to replay the DEX behavior and reaction to a given order. This implies computing the swap amount in and out after each transaction, keeping track of the reserve amount of both tokens present in the pool which would have been already complex. This would have allowed us to draw fack trader swap with fake data to give to the exchange and see how the fee model would have reacted. But we should take into account the fact that the trader&#39;s arbitrage behavior is linked to the price difference. (When the difference is 0 there are less arbitrageurs and opposite) It means complex copulas and multivariate gaussian law etc &hellip; The price difference is a cointegrated process because both prices move together in the same direction and the difference is going to 0 after some trades. So we could have used some AR(1) process to model this difference only and then use this difference to generate some fake arbitrager trades. The price difference is stationary because we cans stipulate the the dex and cex price are stationary which makes total sense cause they are the same asset and arbitrageurs always move to remove the difference Then we don&#39;t really need to care of using the z score also because we will redo a different calibration for a different pair &nbsp;(so we don&#39;t need to normalize the time series of the difference)</span></li><li class="c6 c8 li-bullet-0"><span class="c1">We can take the january month to calibrate and the february month to test the out of sample performances</span></li><li class="c6 c8 li-bullet-0"><span class="c1">Transaction fee model based on the meme pool and not the transactions in the block which means we need to process more data to get the relationship between market configuration (price differences, volatility&hellip;) and the max gas price paid to be first in the block</span></li></ul><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">The different metrics that are used to look at the performance of the model are as follow:</span></p><p class="c6"><span class="c1">&#39;markout&#39;,&#39;cfee&#39;, &#39;dfee&#39;, &#39;cpnl&#39;, &#39;dpnl&#39;, &#39;cfee_cumul&#39;, &#39;dfee_cumul&#39;, &#39;avg_7m_cfee&#39;, &#39;cpnl_5m_positive&#39;, &#39;cpnl_5m_negative&#39;, &#39;c%_toxic_flow_ma_7m&#39;, &#39;dpnl_5m_positive&#39;, &#39;dpnl_5m_negative&#39;, &#39;d%_toxic_flow_ma_7m&#39;</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15">&#39;Markout&#39;</span><span class="c1">&nbsp;is the markout of the price on a 1 minute timeframe</span></p><p class="c6"><span class="c1">&#39;dfee&#39;</span></p><p class="c6"><span class="c1">&#39;cfee&#39;</span></p><p class="c6"><span class="c1">&#39;Cpnl&#39;</span></p><p class="c6"><span class="c1">&hellip;</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">At the end the metric we used are:<br></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c15 c20">Different uniswap v4 implementations:</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c11 c25"><a class="c26" href="https://www.google.com/url?q=https://github.com/jdubpark/Uniswap-Hooks/blob/main/contracts/LPFeeRebateHook.sol&amp;sa=D&amp;source=editors&amp;ust=1709283557810503&amp;usg=AOvVaw2CLBn8I8G6N9WGFW2a2uDx">https://github.com/jdubpark/Uniswap-Hooks/blob/main/contracts/LPFeeRebateHook.sol</a></span></p><p class="c6"><span class="c1">Tiered Fee structure, where Liquidity Providers with more than X liquidity in Pool Y can pay less fee for swapping on Pool Y, well, because they are providing the liquidity to that pool.</span></p><p class="c6"><span class="c1">Another possibility is tiered fee structure for accumulated volume traded on Pool Y or all Pools.</span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c1">liquidity = liquiditySupplied[pool_id][_currentSwapper]</span></p><p class="c6"><span class="c1">rebate = int(math.log2(liquidity)) if liquidity &gt; 0 else 0</span></p><p class="c6"><span class="c1">new_fee = max(1, starting_fee - rebate)</span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span class="c11 c25"><a class="c26" href="https://www.google.com/url?q=https://github.com/umbrellaresearch/uniswap-v4-hooks/blob/main/src/2-dynamic-fees/VolatilityFeeHook.sol&amp;sa=D&amp;source=editors&amp;ust=1709283557811784&amp;usg=AOvVaw3dRoKV21rQVrOUzeLsGyas">https://github.com/umbrellaresearch/uniswap-v4-hooks/blob/main/src/2-dynamic-fees/VolatilityFeeHook.sol</a></span></p><p class="c6"><span class="c1">gold-silver pair&rsquo;s volatility</span></p><ul class="c3 lst-kix_xusvxbe2up-0 start"><li class="c6 c8 li-bullet-0"><span class="c1">1% fee for realized 30 days volatility &gt; 14%</span></li><li class="c6 c8 li-bullet-0"><span class="c1">0.30% fee realized 30 days volatility 10% to 14%</span></li><li class="c6 c8 li-bullet-0"><span class="c1">0.05% fee realized 30 days volatility &lt; 10%</span></li></ul><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 872.50px; height: 618.94px;"><img alt="" src="images/image7.png" style="width: 872.50px; height: 618.94px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 838.09px; height: 863.91px;"><img alt="" src="images/image8.png" style="width: 838.09px; height: 863.91px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c16"><span class="c1"></span></p></body></html>